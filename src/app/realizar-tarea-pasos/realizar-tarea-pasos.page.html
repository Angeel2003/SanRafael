<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button 
        defaultHref="/realizar-tarea-principal" 
        aria-label="Volver a la agenda">
      </ion-back-button>
    </ion-buttons>
    <ion-row class="header-row">
      <ion-col size="auto">
        <ion-title class="title">{{ tarea.nombre | uppercase }}</ion-title>
      </ion-col>
      <ion-col size="auto" class="image-col">
        <img 
          [src]="tarea.previewUrl" 
          alt="Pictograma de previsualización de tarea" 
          class="tarea-preview-image" 
        />
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="nivelAccesibilidad != 'Audio' && tipoTarea == 'tarea-por-pasos' && !finTarea">
    <ion-grid>
      <ion-row>
        <ion-col size="12" class="text-container">
          <img *ngIf="nivelAccesibilidad == 'Pictograma'" [src]="tarea.pasosPicto[currentPage]" alt="PASO {{ currentPage + 1 }}" class="task-image" />
          <img *ngIf="nivelAccesibilidad == 'Imagen'" [src]="tarea.pasosImagenes[currentPage]" alt="PASO {{ currentPage + 1 }}" class="task-image"/>
          
          <div *ngIf="nivelAccesibilidad == 'Video'" class="video-container">
            <video 
              [src]="tarea.pasosVideos[currentPage]"
              class="task-video" 
              #videoPlayer
              (click)="togglePlay(videoPlayer, currentPage)">
            </video>
  
            <button 
              class="play-button" 
              [class.hidden]="!showPlayButton[currentPage]" 
              (click)="togglePlay(videoPlayer, currentPage)">
            <ion-icon name="play-outline"></ion-icon>
          </button>
          </div> 


          <p class="task-text">{{ tarea.pasosTexto[currentPage] | uppercase}}</p>
        
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <div *ngIf="nivelAccesibilidad == 'Audio' && tipoTarea == 'tarea-por-pasos' && !finTarea">
    <ion-grid>
      <ion-row>
        <ion-col class="text-container">

          <ion-button 
            *ngIf="!finTarea" 
            (click)="toggleAudio(audioElement)"
            class="audio-button">
            <ion-icon class="volume-icon" name="volume-high" size="large"></ion-icon> 
          </ion-button>  

          <audio #audioElement [src]="tarea.audioCompletoUrl"></audio>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>


  <ion-grid  *ngIf="tipoTarea === 'tarea-comanda' && !finTarea"  style="text-align: center;">
    <ion-row *ngFor="let menu of menus; let i = index" >
      <ion-col>
          <p style="font-size: 150%;">{{ menu.nombre | uppercase}}</p>
      </ion-col>

      <ion-col *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'">
        <img [src]="menu.image.url" alt="Imagen de {{ menu.nombre | uppercase}}" class="menu-image" />
      </ion-col>

      <ion-col>
          <div class="menu-controls">
            <button class="numButton" (click)="decrementar(i)">-</button>
            <span class="numBox">{{ menu.num }}</span>
            <button class="numButton" (click)="aumentar(i)">+</button>
          </div>
      </ion-col>

      <ion-col *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'">
        <img [src]="numberImages[menu.num]" alt="Imagen del numero {{ menu.num }}" class="menu-image" />
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid *ngIf="tipoTarea === 'tarea-material' && !finTarea"  style="text-align: center;">
    <ion-row *ngFor="let item of tarea.items; let i = index" class="container-row">
      <ion-col>
        <img *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'" [src]="item.imagen" alt="Imagen de {{ item.material }}" class="menu-image" />
        <p style="font-size: 150%;">{{ item.material | uppercase}}</p>
      </ion-col>

      <ion-col>
        <img *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'" [src]="item.imgColor" alt="Imagen del color {{ item.color }}" class="menu-image" />
        <p style="font-size: 150%;">{{ item.color | uppercase}}</p>
      </ion-col>

      <ion-col>
        <img *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'" [src]="item.imgTam" alt="Imagen del tamanño {{ item.tamanio }}" class="menu-image" />
        <p style="font-size: 150%;">{{ item.tamanio | uppercase}}</p>
      </ion-col>

      <ion-col>
        <img *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'" [src]="numberImages[item.cantidad]" alt="Imagen de la cantidad {{ item.cantidad }}" class="menu-image" />
        <p style="font-size: 150%;">{{ item.cantidad }}</p>
      </ion-col>
    </ion-row>
  </ion-grid>
  

  <ion-grid  *ngIf="finTarea">
    <ion-row >
      <ion-col size="12" class="image-container">
        <img *ngIf="nivelAccesibilidad != 'Texto' && nivelAccesibilidad != 'Audio'" [src]="imageOk" alt="Imagen de bien" class="task-image"/>
          <p class="task-pictoText">FIN DE LA TAREA</p>
          <ion-button 
            (click)="irAPagPrincipalTarea(tarea, '/agenda')"
            class="finish-task-button">
            TERMINAR TAREA
          </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>


  <div class="pagination-buttons">
    <ion-button class="custom-button" (click)="prevPage(tarea)">
      <ion-icon name="arrow-back-outline"></ion-icon>
    </ion-button>
    <ion-button class="custom-button" (click)="nextPage()" *ngIf="finTarea !== true">
      <ion-icon name="arrow-forward-outline"></ion-icon>
    </ion-button>
  </div>
</ion-content>
